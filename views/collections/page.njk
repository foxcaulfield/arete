{% extends "layouts/base.njk" %}
{% import "partials/components.njk" as components %}

{% block content %}
	<div class="page-header">
		<h1>{{ title }}</h1>
		<div class="page-header__actions">
			<a href="/ui/collections/create" class="btn-primary">+ New Collection</a>
		</div>
	</div>

	{# Search & Filter Bar #}
	<div class="filter-bar" id="filter-bar">
		<form class="filter-bar__form" hx-get="/ui/collections" hx-target="#collections-wrapper" hx-select="#collections-wrapper" hx-push-url="true" hx-trigger="submit">
			<div class="filter-bar__search">
				<input 
					type="text" 
					name="search" 
					placeholder="Search by name or description..." 
					value="{{ filter.search or '' }}"
					class="filter-bar__input"
					autocomplete="off"
				/>
				<button type="submit" class="filter-bar__submit">Search</button>
			</div>
			<div class="filter-bar__options">
				<select name="sortBy" class="filter-bar__select" title="Sort by">
					<option value="updatedAt" {% if filter.sortBy == 'updatedAt' %}selected{% endif %}>Sort: Updated</option>
					<option value="createdAt" {% if filter.sortBy == 'createdAt' %}selected{% endif %}>Sort: Created</option>
					<option value="name" {% if filter.sortBy == 'name' %}selected{% endif %}>Sort: Name</option>
				</select>
				<select name="sortOrder" class="filter-bar__select" title="Sort order">
					<option value="desc" {% if filter.sortOrder == 'desc' %}selected{% endif %}>Descending</option>
					<option value="asc" {% if filter.sortOrder == 'asc' %}selected{% endif %}>Ascending</option>
				</select>
				<select name="limit" class="filter-bar__select" title="Items per page">
					<option value="5" {% if pagination.limit == 5 %}selected{% endif %}>5 / page</option>
					<option value="10" {% if pagination.limit == 10 %}selected{% endif %}>10 / page</option>
					<option value="25" {% if pagination.limit == 25 %}selected{% endif %}>25 / page</option>
				</select>
			</div>
		</form>
		<div class="filter-bar__hint">
			Press Enter or click Search to filter results.
			{% if filter.search %}
				‚Äî <a href="/ui/collections" class="filter-bar__clear">Clear search</a>
			{% endif %}
		</div>
	</div>

	<div id="collections-wrapper">
		{% if data.length == 0 %}
			<div class="card">
				<div class="empty-state">
					{% if filter.search %}
						<div class="empty-state__icon">üîç</div>
						<div class="empty-state__title">No collections found</div>
						<p class="empty-state__text">Try adjusting your search or <a href="/ui/collections">clear filters</a>.</p>
					{% else %}
						<div class="empty-state__icon">üìö</div>
						<div class="empty-state__title">No collections yet</div>
						<p class="empty-state__text">Create your first collection to start adding exercises.</p>
					{% endif %}
				</div>
			</div>
		{% else %}
			{# Pagination Bar #}
			<div class="pagination">
				<span class="pagination__info">{{ pagination.totalItems }} collection{% if pagination.totalItems != 1 %}s{% endif %}</span>

				<div class="pagination__nav">
					{% if pagination.hasPreviousPage %}
						<button
							id="prev-collections-button"
							hx-get="/ui/collections?page={{ pagination.page - 1 }}&limit={{ pagination.limit }}{% if filter.search %}&search={{ filter.search }}{% endif %}&sortBy={{ filter.sortBy }}&sortOrder={{ filter.sortOrder }}"
							hx-select="#collections-wrapper"
							hx-target="#collections-wrapper"
							hx-push-url="true"
						>‚Üê</button>
					{% else %}
						<button disabled>‚Üê</button>
					{% endif %}

					<span class="pagination__page pagination__page--current">{{ pagination.page }}</span>
					<span class="pagination__text">of {{ pagination.totalPages }}</span>

					{% if pagination.hasNextPage %}
						<button
							id="next-collections-button"
							hx-get="/ui/collections?page={{ pagination.page + 1 }}&limit={{ pagination.limit }}{% if filter.search %}&search={{ filter.search }}{% endif %}&sortBy={{ filter.sortBy }}&sortOrder={{ filter.sortOrder }}"
							hx-select="#collections-wrapper"
							hx-target="#collections-wrapper"
							hx-push-url="true"
						>‚Üí</button>
					{% else %}
						<button disabled>‚Üí</button>
					{% endif %}
				</div>
			</div>

			{# Collections Table #}
			<div class="table-wrapper">
				<table id="collections-table">
					<thead>
						{{ components.collectionTableHeader() }}
					</thead>
					<tbody>
						{% for collectionItem in data %}
							{{ components.collectionTableRow(collectionItem) }}
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
	</div>
{% endblock %}