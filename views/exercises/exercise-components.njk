{% macro collectionIdInput(id, name) %}
	{% set localId = "collection-id-" ~ uuid(8) %}
	<div class="form-group card">
		<label for="{{ localId }}">Collection ID dd</label>
		<input id="{{ localId }}" value="{{ id | default('') }}" type="text" name="{{ name }}" />
	</div>
{% endmacro %}

{% macro typeSelect(name, selected) %}
	{% set localId = "exercise-type-" ~ uuid(8) %}
	<div class="form-group card">
		<label for="{{ localId }}">Exercise Type</label>
		<select name="{{ name }}" id="{{ localId }}">
			<option value="FILL_IN_THE_BLANK" {% if selected=="FILL_IN_THE_BLANK" %}selected{% endif %}>
				Fill in the blank
			</option>
			<option value="CHOICE_SINGLE" {% if selected=="CHOICE_SINGLE" %}selected{% endif %}>Choice</option>
		</select>
	</div>
{% endmacro %}

{% macro questionText(name, value="") %}
	{% set localId = "question-input-" ~ uuid(8) %}
	<div class="form-group card">
		<label for="{{ localId }}">Question</label>
		<input type="text" name="{{ name }}" id="{{ localId }}" value="{{ value }}" />
	</div>
{% endmacro %}

{% macro translationText(name, value="") %}
	{% set localId = "translation-input-" ~ uuid(8) %}
	<div class="form-group card">
		<label for="{{ localId }}">Translation</label>
		<input type="text" name="{{ name }}" id="{{ localId }}" value="{{ value }}" />
	</div>
{% endmacro %}

{% macro correctAnswerInput(name, value="") %}
	{% set localId = "correct-answer-input-" ~ uuid(8) %}
	<div class="form-group card">
		<label for="{{ localId }}">Correct Answer</label>
		<input type="text" name="{{ name }}" id="{{ localId }}" value="{{ value }}" />
	</div>
{% endmacro %}

{% macro explanationText(name, value="") %}
	{% set localId = "exercise-explanation-" ~ uuid(8) %}
	<div class="form-group card">
		<label for="{{ localId }}">Explanation</label>
		<textarea name="{{ name }}" id="{{ localId }}">{{ value }}</textarea>
	</div>
{% endmacro %}

{#        #}
{#  TAGS  #}
{#        #}

{# Additional Correct Answers #}
{%
	macro additionalCorrectAnswersInput(
	    name,
	    label,
	    placeholder="Enter additional answers...",
	    value=[]
	)
%}
	{{
		tagsInput(
			name = name,
			label = label,
			placeholder = placeholder,
			value = value,
			tagClass = "additional-correct-answer-tag",
			containerClass = "additional-correct-answers-container"
		)
	}}
{% endmacro %}

{# Wrong / distractor answers #}
{%
	macro distractionAnswersInput(
	    name,
	    label,
	    placeholder="Enter wrong answers...",
	    value=[]
	)
%}
	{{
		tagsInput(
			name = name,
			label = label,
			placeholder = placeholder,
			value = value,
			tagClass = "distractor-tag",
			containerClass = "distractors-container"
		)
	}}
{% endmacro %}

{#
  Generic tag input:
  - name: name for hidden inputs
  - label: field label
  - placeholder: input placeholder
  - value: initial tags array from server (e.g. ['foo', 'bar'])
  - tagClass / containerClass: css hooks to style differently
#}
{%
	macro tagsInput(
		name,
		label,
		placeholder = "Enter values...",
		value = [],
		tagClass = "",
		containerClass = ""
	)
%}
	<div class="form-group card {{ containerClass }}" x-data="{ input: '', tags: {{ value | dump }} }">
		<div class="tags-input-header">
			<label>{{ label }}</label>
			<button type="button" class="text-button" @click="tags = []">Clear</button>
		</div>

		<input
			type="text"
			placeholder="{{ placeholder }}"
			x-model="input"
			@keydown="
				if ($event.key === 'Enter' || $event.key === ',') {
					$event.preventDefault();
					let v = input.trim().replace(/,$/, '');
					if (v) {
						tags.push(v);
						input = '';
					}
				}
			"
		/>

		<div class="tags-container">
			<template x-for="(tag, index) in tags" :key="index">
				<div class="tag {{ tagClass }}">
					<input type="hidden" name="{{ name }}" :value="tag" />
					<span x-text="tag"></span>
					<button class="tag-remove-button" type="button" @click="tags.splice(index, 1)">√ó</button>
				</div>
			</template>
		</div>
	</div>
{% endmacro %}

{#         #}
{#  MEDIA  #}
{#         #}

{%
	macro imageInput(
		name,
		label = "Image",
		withClearButton = false,
		withSetNullButton = false,
		id = "image-input-" ~ name,
	    currentImageUrl = ""
	)
%}
	<div
		class="form-group card"
		x-data="{ previewSrc: '{{ IMAGE_ENDPOINT ~ '/' ~ currentImageUrl if currentImageUrl else '' }}' }"
	>
		<div class="flex justify-between align-center">
			<label for="{{ id }}">{{ label }}</label>
			{% if withClearButton %}
				<button
					type="button"
					class="text-button"
					x-on:click="
						$refs.fileInput.value = '';
						previewSrc = '';
					"
					:disabled="!previewSrc"
				>
					Clear
				</button>
			{% endif %}
			{% if withSetNullButton %}
				<template x-if="previewSrc || '{{ currentImageUrl }}'">
					<label>
						<input type="checkbox" name="setNullImage" id="setNullImage" />
						Set null
					</label>
				</template>
			{% endif %}
		</div>

		<!-- Hidden file input -->
		<input
			type="file"
			name="{{ name }}"
			id="{{ id }}"
			accept="image/*"
			x-ref="fileInput"
			style="display: none;"
			x-on:change="
				const file = $event. target.files[0];
				if (!file) {
					previewSrc = '';
					return;
				}
				const reader = new FileReader();
				reader.onload = (e) => {
					previewSrc = e.target.result;
				};
				reader.readAsDataURL(file);
			"
		/>

		<!-- Custom styled button to trigger file input -->
		<button type="button" class="secondary" x-on:click="$refs.fileInput.click()">
			<span x-show="!previewSrc">üñºÔ∏è Choose Image File</span>
			<span x-show="previewSrc">üîÑ Change Image File</span>
		</button>

		<!-- Image preview -->
		<div x-show="previewSrc" x-cloak class="image-wrapper">
			<img :src="previewSrc" class="preview-image" />
		</div>
	</div>
{% endmacro %}

{%
	macro audioInput(
		name,
		label = "Audio",
		withClearButton = false,
	    withSetNullButton = false,
		id = "audio-input-" ~ name,
	    currentAudioUrl = ""
	)
%}
	<div
		class="form-group card"
		x-data="{ audioSrc: '{{ AUDIO_ENDPOINT ~ '/' ~ currentAudioUrl if currentAudioUrl else '' }}' }"
	>
		<div class="flex justify-between align-center">
			<label for="{{ id }}">{{ label }}</label>
			{% if withClearButton %}
				<button
					type="button"
					class="text-button"
					x-on:click="
						$refs.fileInput.value = '';
						if (audioSrc && audioSrc.startsWith('blob:')) {
							URL. revokeObjectURL(audioSrc);
						}
						audioSrc = '';
					"
					:disabled="!audioSrc"
				>
					Clear
				</button>
			{% endif %}
			{% if withSetNullButton %}
				<template x-if="audioSrc || '{{ currentAudioUrl }}'">
					<label>
						<input type="checkbox" name="setNullAudio" id="setNullAudio" />
						Set null
					</label>
				</template>
			{% endif %}
		</div>

		<!-- Hidden file input -->
		<input
			type="file"
			name="{{ name }}"
			id="{{ id }}"
			accept="audio/*"
			x-ref="fileInput"
			style="display: none;"
			x-on:change="
				const file = $event. target.files[0];
				if (!file) {
					if (audioSrc && audioSrc.startsWith('blob:')) {
						URL.revokeObjectURL(audioSrc);
					}
					audioSrc = '';
					return;
				}
				if (audioSrc && audioSrc.startsWith('blob:')) {
					URL.revokeObjectURL(audioSrc);
				}
				audioSrc = URL.createObjectURL(file);
			"
		/>

		<!-- Custom styled button to trigger file input -->
		<button type="button" class="secondary" x-on:click="$refs.fileInput.click()">
			<span x-show="!audioSrc">üìÅ Choose Audio File</span>
			<span x-show="audioSrc">üîÑ Change Audio File</span>
		</button>

		<!-- Set to null option -->

		<!-- Audio player preview -->
		<div x-show="audioSrc" x-cloak class="audio-wrapper">
			<audio :src="audioSrc" controls class="width-100"></audio>
		</div>
	</div>
{% endmacro %}

{#         #}
{# ACTIONS #}
{#         #}

{%
	macro actionButtons(
		collectionId='',
		submitLabel='Submit',
		cancelLabel='Cancel',
		cancelUrl=''
	)
%}
	<div class="form-group flex justify-between align-center">
		<button type="button" class="secondary" onclick="window.location.href='{{ cancelUrl or '/' }}'">
			{{ cancelLabel }}
		</button>
		<button type="submit" class="primary" style="width: 200px;">{{ submitLabel }}</button>
	</div>
{% endmacro %}
