{% macro collectionIdInput(id, name) %}
	<div class="form-group">
		<label for="collectionId">Collection ID dd</label>
		<input id="collectionId" value="{{ id | default('') }}" type="text" name="{{ name }}" />
	</div>
{% endmacro %}

{% macro typeSelect(name) %}
	<div class="form-group">
		<label for="exercise-type">Exercise Type</label>
		<select name="{{ name }}" id="exercise-type">
			<option value="FILL_IN_THE_BLANK">Fill in the blank</option>
			<option value="CHOICE_SINGLE">Choice</option>
		</select>
	</div>
{% endmacro %}

{% macro questionText(name) %}
	<div class="form-group">
		<label for="question-input">Question</label>
		<input type="text" name="{{ name }}" />
	</div>
{% endmacro %}

{% macro translationText(name) %}
	<div class="form-group">
		<label for="translation-input">Translation</label>
		<input type="text" name="{{ name }}" id="translation-input" />
	</div>
{% endmacro %}

{% macro correctAnswerInput(name) %}
	<div class="form-group">
		<label for="correct-answer-input">Correct Answer</label>
		<input type="text" name="{{ name }}" id="correct-answer-input" />
	</div>
{% endmacro %}

{# Additional Correct Answers – Alpine, no functions, configurable name/label/placeholder #}
{% macro additionalCorrectAnswersInput(name, label, placeholder="Enter additional answers...") %}
	<div class="form-group" x-data="{ input: '', answers: [] }">
		<div class="additional-correct-answers-input">
			<div>
				<label>{{ label }}</label>
				<button type="button" @click="answers = []">Clear</button>
			</div>

			<input
				type="text"
				placeholder="{{ placeholder }}"
				x-model="input"
				@keydown="
					if ($event.key === 'Enter' || $event.key === ',') {
						$event.preventDefault();
						let v = input.trim().replace(/,$/, '');
						if (v) {
							answers.push(v);
							input = '';
						}
					}
				"
			/>
		</div>

		<div class="additional-correct-answers-container">
			<template x-for="(answer, index) in answers" :key="index">
				<div class="tag additional-correct-answer-tag">
					<input type="hidden" name="{{ name }}" :value="answer" />
					<span x-text="answer"></span>
					<button type="button" @click="answers.splice(index, 1)">×</button>
				</div>
			</template>
		</div>
	</div>
{% endmacro %}

{# Wrong / distractor answers – Alpine, no functions #}
{% macro distractionAnswersInput(name, label, placeholder="Enter wrong answers...") %}
	<div class="form-group" x-data="{ input: '', distractors: [] }">
		<div class="distractors-input">
			<div>
				<label>{{ label }}</label>
				<button type="button" @click="distractors = []">Clear</button>
			</div>

			<input
				type="text"
				placeholder="{{ placeholder }}"
				x-model="input"
				@keydown="
					if ($event.key === 'Enter' || $event.key === ',') {
						$event.preventDefault();
						let v = input.trim().replace(/,$/, '');
						if (v) {
							distractors.push(v);
							input = '';
						}
					}
				"
			/>
		</div>

		<div class="distractors-container">
			<template x-for="(distractor, index) in distractors" :key="index">
				<div class="tag distractor-tag">
					<input type="hidden" name="{{ name }}" :value="distractor" />
					<span x-text="distractor"></span>
					<button type="button" @click="distractors.splice(index, 1)">×</button>
				</div>
			</template>
		</div>
	</div>
{% endmacro %}

{% macro explanationText(name) %}
	<div class="form-group">
		<label for="exercise-explanation">Explanation</label>
		<textarea name="{{ name }}" id="exercise-explanation"></textarea>
	</div>
{% endmacro %}

{% macro imageInput(
	name,
	label = "Image",
	withClearButton = false,
	id = "image-input-" ~ name
) %}
	<div
		class="form-group"
		x-data="{ previewSrc: '' }"
	>
		<label for="{{ id }}">{{ label }}</label>

		<input
			type="file"
			name="{{ name }}"
			id="{{ id }}"
			accept="image/*"
			x-ref="fileInput"
			x-on:change="
				const file = $event.target.files[0];
				if (!file) {
					previewSrc = '';
					return;
				}
				const reader = new FileReader();
				reader.onload = (e) => {
					previewSrc = e.target.result;
				};
				reader.readAsDataURL(file);
			"
		/>

		{% if withClearButton %}
			<button
				type="button"
				x-on:click="
					$refs.fileInput.value = '';
					previewSrc = '';
				"
				:disabled="!previewSrc"
			>
				Clear
			</button>
		{% endif %}

		<img
			x-show="previewSrc"
			:src="previewSrc"
			style="max-width:200px;margin-top:8px;border-radius:4px"
		/>
	</div>
{% endmacro %}

{% macro audioInput(
	name,
	label = "Audio",
	withClearButton = false,
	id = "audio-input-" ~ name
) %}
	<div
		class="form-group"
		x-data="{ audioSrc: '' }"
	>
		<label for="{{ id }}">{{ label }}</label>

		<input
			type="file"
			name="{{ name }}"
			id="{{ id }}"
			accept="audio/*"
			x-ref="fileInput"
			x-on:change="
				const file = $event.target.files[0];
				if (!file) {
					if (audioSrc && audioSrc.startsWith('blob:')) {
						URL.revokeObjectURL(audioSrc);
					}
					audioSrc = '';
					return;
				}
				if (audioSrc && audioSrc.startsWith('blob:')) {
					URL.revokeObjectURL(audioSrc);
				}
				audioSrc = URL.createObjectURL(file);
			"
		/>

		{% if withClearButton %}
			<button
				type="button"
				x-on:click="
					$refs.fileInput.value = '';
					if (audioSrc && audioSrc.startsWith('blob:')) {
						URL.revokeObjectURL(audioSrc);
					}
					audioSrc = '';
				"
				:disabled="!audioSrc"
			>
				Clear
			</button>
		{% endif %}

		<audio
			x-show="audioSrc"
			:src="audioSrc"
			controls
			style="margin-top:8px;"
		></audio>
	</div>
{% endmacro %}

{% macro actionButtons(collectionId='') %}
	<div class="form-group">
		<button type="submit">Create Exercise</button>
		<button type="button" onclick="window.location.href='/ui/collections/{{ collectionId or \'\' }}'">
			Cancel
		</button>
	</div>
{% endmacro %}